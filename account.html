<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="–ü—Ä–æ—Ñ–∏–ª—å –Ω–∞ GiftDrop.ru ‚Äî –∏—Å—Ç–æ—Ä–∏—è –æ—Ç–∫—Ä—ã—Ç–∏–π, —Ä–µ—Ñ–µ—Ä–∞–ª—ã, –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∏ –≤—ã–≤–æ–¥ –±–∞–ª–∞–Ω—Å–∞.">
    <meta name="keywords" content="GiftDrop –ø—Ä–æ—Ñ–∏–ª—å, –∏—Å—Ç–æ—Ä–∏—è –∫–µ–π—Å–æ–≤, —Ä–µ—Ñ–µ—Ä–∞–ª–∫–∞, –≤—ã–≤–æ–¥ –±–∞–ª–∞–Ω—Å–∞">
    <meta name="robots" content="index, follow">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <title>–ü—Ä–æ—Ñ–∏–ª—å ‚Äî GiftDrop.ru</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="header">
        <div class="header-left">
            <div class="close-btn">√ó</div>
            <div class="header-title">Gift Drop</div>
        </div>
        <div class="header-right">
            <div class="deposit-btn">
                <span>+</span>
                <span>Deposit</span>
            </div>
            <div class="profile-img">U</div>
        </div>
    </div>

    <div class="profile-container">
        <div class="profile-header">
            <div class="profile-avatar">üë§</div>
            <h2 id="profile-username">–ê–Ω–æ–Ω–∏–º–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</h2>
            <p id="profile-refcode">–í–∞—à —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥: <strong id="ref-code">-----</strong></p>
            <div class="profile-balance">
                <span>–ë–∞–ª–∞–Ω—Å:</span>
                <strong id="profile-balance">0</strong> üíé
            </div>
        </div>

        <div class="profile-tabs">
            <button class="tab-btn active" data-tab="overview">–û–±–∑–æ—Ä</button>
            <button class="tab-btn" data-tab="history">–ò—Å—Ç–æ—Ä–∏—è</button>
            <button class="tab-btn" data-tab="referrals">–†–µ—Ñ–µ—Ä–∞–ª—ã</button>
            <button class="tab-btn" data-tab="achievements">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</button>
            <button class="tab-btn" data-tab="settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
        </div>

        <div class="tab-content active" id="tab-overview">
            <div class="profile-section">
                <h3>üìä –í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <span>–û—Ç–∫—Ä—ã—Ç–æ –∫–µ–π—Å–æ–≤</span>
                        <strong id="stat-opened">0</strong>
                    </div>
                    <div class="stat-item">
                        <span>–í—ã–∏–≥—Ä–∞–Ω–æ</span>
                        <strong id="stat-won">0</strong> üíé
                    </div>
                    <div class="stat-item">
                        <span>–†–µ—Ñ–µ—Ä–∞–ª–æ–≤</span>
                        <strong id="stat-referrals">0</strong>
                    </div>
                    <div class="stat-item">
                        <span>–î–æ—Å—Ç–∏–∂–µ–Ω–∏–π</span>
                        <strong id="stat-achievements">0</strong>
                    </div>
                </div>
            </div>

            <div class="profile-section">
                <h3>üéÅ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å</h3>
                <p>–ü–æ–ª—É—á–∞–π—Ç–µ <strong>100üíé</strong> –∫–∞–∂–¥—ã–π –¥–µ–Ω—å!</p>
                <button class="daily-bonus-btn" id="daily-bonus-btn">–ü–æ–ª—É—á–∏—Ç—å –±–æ–Ω—É—Å</button>
                <p id="daily-bonus-timer" style="color: #aaa; margin-top: 10px;">‚è≥ –°–ª–µ–¥—É—é—â–∏–π –±–æ–Ω—É—Å —á–µ—Ä–µ–∑: 23:59:59</p>
            </div>
        </div>

        <div class="tab-content" id="tab-history">
            <h3>üìú –ò—Å—Ç–æ—Ä–∏—è –æ—Ç–∫—Ä—ã—Ç–∏–π</h3>
            <div id="history-list" class="history-list">
                <p style="color: #aaa; text-align: center;">–ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ ‚Äî –æ—Ç–∫—Ä–æ–π—Ç–µ –ø–µ—Ä–≤—ã–π –∫–µ–π—Å!</p>
            </div>
        </div>

        <div class="tab-content" id="tab-referrals">
            <h3>ü§ù –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞</h3>
            <p>–ü—Ä–∏–≥–ª–∞—à–∞–π—Ç–µ –¥—Ä—É–∑–µ–π ‚Äî –ø–æ–ª—É—á–∞–π—Ç–µ <strong>10% –æ—Ç –∏—Ö –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–π</strong>!</p>
            <div class="referral-box">
                <input type="text" id="ref-link" value="https://giftdrop.ru?ref=-----" readonly>
                <button class="copy-btn" onclick="copyToClipboard('#ref-link')">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>
            <div class="referral-stats">
                <p>–ü—Ä–∏–≤–ª–µ—á–µ–Ω–æ: <strong id="ref-count">0</strong> –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>
                <p>–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: <strong id="ref-earnings">0</strong> üíé</p>
            </div>
            <div class="referral-list" id="referral-list">
                <p style="color: #aaa; text-align: center;">–ü–æ–∫–∞ –Ω–µ—Ç –ø—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã—Ö</p>
            </div>
        </div>

        <div class="tab-content" id="tab-achievements">
            <h3>üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h3>
            <div class="achievements-grid" id="achievements-grid">
                <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è JS -->
            </div>
            <p style="color: #aaa; margin-top: 20px; text-align: center;">–ü–æ–ª—É—á–∏—Ç–µ –≤—Å–µ ‚Äî –∏ —Å—Ç–∞–Ω—å—Ç–µ –ª–µ–≥–µ–Ω–¥–æ–π!</p>
        </div>

        <div class="tab-content" id="tab-settings">
            <h3>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
            <div class="setting-item">
                <label>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</label>
                <label class="switch">
                    <input type="checkbox" id="notifications-toggle" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <div class="setting-item">
                <label>–¢–µ–º–Ω–∞—è —Ç–µ–º–∞</label>
                <label class="switch">
                    <input type="checkbox" id="dark-theme-toggle" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <button class="logout-btn" onclick="logout()">–í—ã–π—Ç–∏</button>
        </div>
    </div>

    <div class="nav-bar">
        <div class="nav-item" onclick="window.location.href='/'">
            <div class="nav-icon">üéÅ</div>
            <div class="nav-text">Cases</div>
        </div>
        <div class="nav-item" onclick="window.location.href='/games.html'">
            <div class="nav-icon">üéÆ</div>
            <div class="nav-text">Games</div>
        </div>
        <div class="nav-item active">
            <div class="nav-icon">üë§</div>
            <div class="nav-text">Profile</div>
        </div>
    </div>

    <script>
        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const user = JSON.parse(localStorage.getItem('giftdrop_user') || '{}');
        const balance = parseInt(localStorage.getItem('giftdrop_balance') || '0');
        const history = JSON.parse(localStorage.getItem('giftdrop_history') || '[]');
        const referrals = JSON.parse(localStorage.getItem('giftdrop_referrals') || '[]');
        const achievements = JSON.parse(localStorage.getItem('giftdrop_achievements') || '[]');
        const dailyBonus = localStorage.getItem('giftdrop_daily_bonus') || null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        if (!user.id) {
            window.location.href = '/'; // –ï—Å–ª–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω ‚Äî –Ω–∞ –≥–ª–∞–≤–Ω—É—é
        }

        document.getElementById('profile-username').textContent = user.username || '–ê–Ω–æ–Ω–∏–º';
        document.getElementById('ref-code').textContent = user.ref_code || '-----';
        document.getElementById('profile-balance').textContent = balance;

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        document.getElementById('stat-opened').textContent = history.length;
        document.getElementById('stat-won').textContent = history.reduce((sum, h) => sum + h.value, 0);
        document.getElementById('ref-count').textContent = referrals.length;
        document.getElementById('ref-earnings').textContent = referrals.reduce((sum, r) => sum + r.earnings, 0);
        document.getElementById('stat-referrals').textContent = referrals.length;
        document.getElementById('stat-achievements').textContent = achievements.length;

        // –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞
        document.getElementById('ref-link').value = `https://giftdrop.ru?ref=${user.ref_code}`;

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
        const achievementsData = [
            { id: 'open10', name: '–ù–æ–≤–∏—á–æ–∫', desc: '–û—Ç–∫—Ä—ã–ª 10 –∫–µ–π—Å–æ–≤', icon: 'üéñÔ∏è', achieved: false },
            { id: 'open50', name: '–≠–Ω—Ç—É–∑–∏–∞—Å—Ç', desc: '–û—Ç–∫—Ä—ã–ª 50 –∫–µ–π—Å–æ–≤', icon: 'üî•', achieved: false },
            { id: 'open100', name: '–ü—Ä–æ—Ñ–∏', desc: '–û—Ç–∫—Ä—ã–ª 100 –∫–µ–π—Å–æ–≤', icon: 'üèÜ', achieved: false },
            { id: 'win1000', name: '–ë–æ–≥–∞—á', desc: '–í—ã–∏–≥—Ä–∞–ª 1000üíé', icon: 'üíé', achieved: false },
            { id: 'ref1', name: '–ü—Ä–∏–≥–ª–∞—Å–∏–ª', desc: '–ü—Ä–∏–≥–ª–∞—Å–∏–ª 1 –¥—Ä—É–≥–∞', icon: 'ü§ù', achieved: false },
            { id: 'ref5', name: '–¢–∏–º–ª–∏–¥', desc: '–ü—Ä–∏–≥–ª–∞—Å–∏–ª 5 –¥—Ä—É–∑–µ–π', icon: 'üë•', achieved: false },
            { id: 'daily7', name: '–ü–æ—Å—Ç–æ—è–ª–µ—Ü', desc: '–ü–æ–ª—É—á–∞–ª –±–æ–Ω—É—Å 7 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥', icon: 'üìÖ', achieved: false },
            { id: 'all', name: '–õ–µ–≥–µ–Ω–¥–∞', desc: '–ü–æ–ª—É—á–∏–ª –≤—Å–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è', icon: '‚ú®', achieved: false }
        ];

        const achievementsGrid = document.getElementById('achievements-grid');
        achievementsData.forEach(a => {
            a.achieved = achievements.includes(a.id);
            const el = document.createElement('div');
            el.className = 'achievement-item';
            el.innerHTML = `
                <div class="achievement-icon">${a.icon}</div>
                <div class="achievement-info">
                    <strong>${a.name}</strong>
                    <small>${a.desc}</small>
                </div>
                <div class="achievement-badge ${a.achieved ? 'achieved' : ''}">
                    ${a.achieved ? '‚úîÔ∏è' : 'üîí'}
                </div>
            `;
            achievementsGrid.appendChild(el);
        });

        // –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å
        const dailyBonusBtn = document.getElementById('daily-bonus-btn');
        const dailyBonusTimer = document.getElementById('daily-bonus-timer');

        function updateDailyBonusTimer() {
            if (!dailyBonus) {
                dailyBonusBtn.disabled = false;
                dailyBonusBtn.textContent = '–ü–æ–ª—É—á–∏—Ç—å –±–æ–Ω—É—Å';
                dailyBonusTimer.textContent = '‚è≥ –°–ª–µ–¥—É—é—â–∏–π –±–æ–Ω—É—Å —á–µ—Ä–µ–∑: 23:59:59';
                return;
            }

            const last = new Date(dailyBonus);
            const now = new Date();
            const tomorrow = new Date(now);
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(0, 0, 0, 0);

            const diffMs = tomorrow - now;
            const hours = Math.floor(diffMs / 3600000);
            const minutes = Math.floor((diffMs % 3600000) / 60000);
            const seconds = Math.floor((diffMs % 60000) / 1000);

            dailyBonusTimer.textContent = `‚è≥ –°–ª–µ–¥—É—é—â–∏–π –±–æ–Ω—É—Å —á–µ—Ä–µ–∑: ${hours.toString().padStart(2,'0')}:${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`;
            dailyBonusBtn.disabled = true;
            dailyBonusBtn.textContent = '–ë–æ–Ω—É—Å —É–∂–µ –ø–æ–ª—É—á–µ–Ω!';
        }

        updateDailyBonusTimer();
        setInterval(updateDailyBonusTimer, 1000);

        dailyBonusBtn.addEventListener('click', () => {
            if (dailyBonus) return;
            const now = new Date().toISOString();
            localStorage.setItem('giftdrop_daily_bonus', now);
            balance += 100;
            localStorage.setItem('giftdrop_balance', balance);
            document.getElementById('profile-balance').textContent = balance;
            document.getElementById('stat-won').textContent = parseInt(document.getElementById('stat-won').textContent) + 100;
            achievements.push('daily7');
            localStorage.setItem('giftdrop_achievements', JSON.stringify([...new Set(achievements)]));
            alert('üéâ –í—ã –ø–æ–ª—É—á–∏–ª–∏ 100üíé –∑–∞ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å!');
            updateDailyBonusTimer();
        });

        // –ò—Å—Ç–æ—Ä–∏—è –æ—Ç–∫—Ä—ã—Ç–∏–π
        const historyList = document.getElementById('history-list');
        if (history.length > 0) {
            historyList.innerHTML = '';
            history.slice(-15).reverse().forEach(h => {
                const el = document.createElement('div');
                el.className = 'history-item';
                el.innerHTML = `
                    <span class="history-time">${new Date(h.time).toLocaleTimeString()}</span>
                    <span class="history-case">${h.case}</span>
                    <span class="history-value">+${h.value}üíé</span>
                `;
                historyList.appendChild(el);
            });
        }

        // –í–∫–ª–∞–¥–∫–∏
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                btn.classList.add('active');
                document.getElementById(`tab-${btn.dataset.tab}`).classList.add('active');
            });
        });

        // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏
        function copyToClipboard(selector) {
            const el = document.querySelector(selector);
            el.select();
            document.execCommand('copy');
            alert('üîó –°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
        document.getElementById('notifications-toggle').addEventListener('change', (e) => {
            localStorage.setItem('giftdrop_notifications', e.target.checked);
        });

        document.getElementById('dark-theme-toggle').addEventListener('change', (e) => {
            if (e.target.checked) {
                document.body.classList.add('dark-theme');
            } else {
                document.body.classList.remove('dark-theme');
            }
            localStorage.setItem('giftdrop_dark_theme', e.target.checked);
        });

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–º—ã
        if (localStorage.getItem('giftdrop_dark_theme') === 'true') {
            document.body.classList.add('dark-theme');
        }

        // –í—ã—Ö–æ–¥
        function logout() {
            localStorage.removeItem('giftdrop_user');
            localStorage.removeItem('giftdrop_balance');
            localStorage.removeItem('giftdrop_history');
            localStorage.removeItem('giftdrop_referrals');
            localStorage.removeItem('giftdrop_achievements');
            localStorage.removeItem('giftdrop_daily_bonus');
            window.location.href = '/';
        }

        // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ LIVE-–¥—Ä–æ–ø–æ–≤
        const eventSource = new EventSource('/api/live-drops.php');
        eventSource.onmessage = function(e) {
            const drop = JSON.parse(e.data);
            const liveList = document.getElementById('live-drops-list');
            if (liveList) {
                const dropElement = document.createElement('div');
                dropElement.className = 'live-drop';
                dropElement.innerHTML = `
                    <strong>${drop.user}</strong> –æ—Ç–∫—Ä—ã–ª <strong>${drop.case}</strong> –∏ –≤—ã–∏–≥—Ä–∞–ª <strong>${drop.item}</strong> (${drop.value}$)
                `;
                liveList.insertBefore(dropElement, liveList.firstChild);
                if (liveList.children.length > 10) liveList.removeChild(liveList.lastChild);
            }
        };
        eventSource.onerror = function() {
            if (document.getElementById('live-drops-list')) {
                document.getElementById('live-drops-list').innerHTML = 
                    '<div class="live-drop">‚ùå –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º</div>';
            }
        };
    </script>
</body>
</html>